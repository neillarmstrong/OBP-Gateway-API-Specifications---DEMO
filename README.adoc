= Integrating with Optiva's API Gateway

== Table of Contents
* <<Overview>>
* <<Getting Started>>
* <<Configuring Keycloak for User Authentication>>
* <<Request Sequencing for Complex Workflows>>

== Overview
Optiva's API gateway enables integrators to leverage the power of Optiva's BSS and Customer Management solutions with third-party applications.

Optiva's API gateway has the three following API Specifications:

* *cmsapigw-swagger -* Optiva's Customer Management API, which includes a series of requests that allow third-party applications to offer the functionality of Optiva's Customer Management Portal. 

* *obp-rtr-apigw -* Optiva's BSS API (REST to REST), which includes a series of requests to interact with Optiva's BSS.   

* *obp-rts-apigw -* Optiva's BSS API (REST to SOAP), which includes a series of requests to interact with Optiva's BSS. 

Optiva's API leverages endpoints that are goal-oriented and that can be used either individually or as part of a more complex workflow.

*Note:* Optiva's API specifications are hollistic and include both requests that can be integrated against by third parties as well as requests that are only for Optiva's use.

== Getting Started

Optiva's API gateway uses Keycloak for authentication of requests.

=== Introduction to Keycloak

https://www.keycloak.org/[Keycloak] is used to provide the identity management module for secure access between applications within OBP.

Keycloak provides Single Sign-On (SSO) capability, Identity Brokering, User Federation, and Authorization Services. Keycloak supports external IDPs such as LDAP or ADP via User Federation and SSO redirect for OIDC & SAML logins via Identity Brokering.

A Keycloak instance is deployed into the *Infra* cluster as part of the OBP deployment pipeline.

image::./Readme_images/Keycloak_UI.png[Example Keycloak web UI screen]

=== Keycloak Configuration Overview

To setup Keycloak for use with Optiva's APIs, you must perform the following tasks:


. <<Identifying the Keycloak Admin Account>>

. <<Creating a Keycloak Realm>>

. <<Creating a Keycloak User>>

. <<Creating Keycloak Client Realm Roles for Customer Management Database>>

. <<Creating a Keycloak User Account for Customer Management Database>>

. <<Creating a Client and Users for API Gateway Access>>

.. <<Creating a BSS User Account for an API Gateway>>

.. <<Creating Keycloak Client Scopes for API Gateway>>

.. <<Creating Keycloak Client for API Gateway>>

.. <<Creating a Keycloak User Account for an API Gateway>>


== Configuring Keycloak for User Authentication

=== Identifying the Keycloak Admin Account

=== Creating a Keycloak Realm

=== Creating a Keycloak User

=== Creating a Client and Users for API Gateway Access

==== Creating a BSS User Account for an API Gateway

==== Creating Keycloak Client Scopes for API Gateway

==== Creating Keycloak Client for API Gateway

==== Creating a Keycloak User Account for an API Gateway


== Request Sequencing for Complex Workflows

Paragraph to cover how requests can acheive single goals or be stitched together into a more complex user journeys.

=== Provisioning a New Subscriber

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===

=== Mobile Number Porting

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Managing Entities

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Managing Party Interactions

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Adding Notes to Accounts and Subscriptions

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Using Payment Schedules

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Managing Payment Methods

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Using Refer a Friend Bonuses

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Adding Products to a Subscription

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Changing a Subscription Plan

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Managing Offers


[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Blocking a SIM

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
=== Using a Shopping Cart

[cols="1,1,1,1,1"]
|===
|*User Journey*
|*API Specification*
|*Sequence*
|*Request Type*
|*Endpoint*

|User Journey 1
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3

|
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 
|Cell in column 2, row 3 

|User Journey 2
|Cell in column 2, row 2
|Cell in column 1, row 2
|Cell in column 2, row 2
|Cell in column 1, row 3
|===
